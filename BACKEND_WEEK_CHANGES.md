# Backend Changes Required for Week-Based Menu System

## Database Schema Updates

### Menu Table
Add new column `weekId` to store week identifier:
```sql
ALTER TABLE menu ADD COLUMN weekId TEXT;
CREATE INDEX idx_menu_weekId ON menu(weekId);
```

## API Endpoint Updates

### GET /menu
Add optional `weekId` query parameter to filter by week:
```typescript
app.get("/make-server-49570ec2/menu", async (c) => {
  const weekId = c.req.query("weekId");
  
  if (weekId) {
    const items = await kv.getByPrefix(`menu:${weekId}:`);
    return c.json({ success: true, data: items });
  }
  
  // Return all if no weekId specified
  const items = await kv.getByPrefix("menu:");
  return c.json({ success: true, data: items });
});
```

### POST /menu
Accept `weekId` in payload and store it:
```typescript
app.post("/make-server-49570ec2/menu", async (c) => {
  const body = await c.req.json();
  const { weekId, day, name, ...rest } = body;
  
  // Generate ID with week prefix: menu:{weekId}:{day}:{uuid}
  const id = `menu:${weekId}:${day}:${crypto.randomUUID()}`;
  
  const menuItem = {
    id,
    weekId,
    day,
    name,
    ...rest,
    createdAt: new Date().toISOString(),
  };
  
  await kv.set(id, menuItem);
  return c.json({ success: true, data: menuItem });
});
```

## Week Identifier Format
- Format: `YYYY-WW` (e.g., "2025-46")
- Generated by client using `getWeekIdentifier()` function
- Consistent across timezone

## Migration Plan
1. Add `weekId` column to existing menu items (set to current week)
2. Update API endpoints to support filtering
3. Test with existing data
4. Deploy changes

## Benefits
- ✅ Menu items are scoped to specific weeks
- ✅ Old menu items don't show up in current week
- ✅ Orders are validated against correct week
- ✅ Easy to manage menu changes week-by-week
